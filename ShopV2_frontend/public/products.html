<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Товари</title>
    <style>
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .container { max-width: 800px; margin: auto; }
        .product { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <h1>Список товарів</h1>
            <div>
                <button onclick="logout()">Вийти</button>
            </div>
        </div>

        <div id="productsList"></div>

        <h2>Додати новий продукт</h2>
        <form id="addProductForm">
            <label>
                Назва:
                <input type="text" id="name" required>
            </label><br><br>
            <label>
                Опис:
                <textarea id="description"></textarea>
            </label><br><br>
            <label>
                Ціна:
                <input type="number" id="price" step="0.01" required>
            </label><br><br>
            <button type="submit">Додати продукт</button>
        </form>
    </div>

    <script type="module">
        const token = localStorage.getItem("access_token");

        if (!token) {
            window.location.href = "login.html";
        }

        const headers = {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
        };

        const productsList = document.getElementById("productsList");
        const form = document.getElementById("addProductForm");

        async function fetchProducts() {
            try {
                const response = await fetch("http://localhost:8000/api/products/", {
                    headers
                });
                const products = await response.json();

                productsList.innerHTML = products.map(p => `
                    <div class="product">
                        <h3>${p.name}</h3>
                        <p>${p.description}</p>
                        <p><strong>Ціна:</strong> ${p.price} грн</p>
                    </div>
                `).join("");
            } catch (err) {
                console.error("Помилка завантаження продуктів:", err);
            }
        }

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const newProduct = {
                name: document.getElementById("name").value,
                description: document.getElementById("description").value,
                price: parseFloat(document.getElementById("price").value)
            };

            try {
                const response = await fetch("http://localhost:8000/api/products/add", {
                    method: "POST",
                    headers,
                    body: JSON.stringify(newProduct)
                });

                if (response.ok) {
                    await fetchProducts();
                    form.reset();
                } else {
                    const data = await response.json();
                    alert(data.detail || "Не вдалося додати продукт");
                }
            } catch (error) {
                console.error("Помилка додавання продукту:", error);
            }
        });

        function logout() {
            localStorage.removeItem("access_token");
            window.location.href = "login.html";
        }

        fetchProducts();
    </script>
</body>
</html>
