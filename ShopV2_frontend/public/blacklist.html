<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ß–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫</title>
    <style>
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .container { max-width: 800px; margin: auto; }
        .blacklisted-user { border: 1px solid red; padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <h1>–ß–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h1>
            <div>
                <span id="userGreeting"></span>
                <button onclick="logout()">–í–∏–π—Ç–∏</button>
            </div>
        </div>

        <p><strong>–¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏—à–µ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞!</strong></p>

        <div id="blacklistContainer"></div>

        <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>
    </div>

    <script type="module">
        const token = localStorage.getItem("access_token");

        if (!token) {
            window.location.href = "login.html";
        }

        const headers = {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
        };

        const blacklistContainer = document.getElementById("blacklistContainer");
        const userGreeting = document.getElementById("userGreeting");

        async function loadBlacklist() {
            try {
                const response = await fetch("http://localhost:8000/api/blacklist/", {
                    headers
                });

                if (!response.ok) {
                    throw new Error("–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –∞–±–æ –¥–æ—Å—Ç—É–ø—É");
                }

                const data = await response.json();

                blacklistContainer.innerHTML = data.map(entry => `
                    <div class="blacklisted-user">
                        <p><strong>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:</strong> ${entry.username}</p>
                        <p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> ${entry.reason}</p>
                        <p><strong>–î–∞—Ç–∞:</strong> ${new Date(entry.created_at).toLocaleString("uk-UA")}</p>
                    </div>
                `).join("");

                userGreeting.textContent = "–ü—Ä–∏–≤—ñ—Ç, –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–µ! üí´";

            } catch (error) {
                blacklistContainer.innerHTML = `<p style="color:red;">${error.message}</p>`;
            }
        }

        function logout() {
            localStorage.removeItem("access_token");
            window.location.href = "login.html";
        }

        loadBlacklist();
    </script>
</body>
</html>
